<?php

namespace Wpshop\Quizle;

class Social {

    /**
     * @var array
     */
    protected $share_providers;

    protected $messengers;

    /**
     * Constructor
     */
    public function __construct() {
        $this->share_providers = [
            'vkontakte'     => [
                'title'  => _x( 'Vkontakte', 'social provider', QUIZLE_TEXTDOMAIN ),
                'width'  => '32',
                'height' => '32',
                'path'   => 'M17.25 24.74C7.68 24.74 2.23 18.18 2 7.26h4.79c.16 8.01 3.69 11.4 6.49 12.1V7.26h4.51v6.91c2.76-.3 5.67-3.45 6.65-6.91h4.51c-.75 4.27-3.9 7.42-6.14 8.71 2.24 1.05 5.82 3.8 7.19 8.76h-4.97c-1.07-3.32-3.72-5.89-7.24-6.24v6.24h-.54Z',
                'color'  => '#07f',
            ],
            'odnoklassniki' => [
                'title'  => _x( 'Odnoklassniki', 'social provider', QUIZLE_TEXTDOMAIN ),
                'width'  => '32',
                'height' => '32',
                'path'   => 'M16.12 2c-4.01 0-7.26 3.25-7.26 7.26s3.25 7.26 7.26 7.26 7.26-3.25 7.26-7.26S20.13 2 16.12 2Zm0 10.26c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3ZM18.68 22.29c2.9-.59 4.65-1.97 4.74-2.04.85-.68.99-1.92.3-2.77a1.96 1.96 0 0 0-2.77-.3c-.02.01-1.87 1.44-4.93 1.44-3.05 0-4.95-1.43-4.97-1.44a1.97 1.97 0 1 0-2.47 3.07c.09.07 1.91 1.49 4.89 2.06l-4.16 4.35c-.76.78-.73 2.03.05 2.79.38.37.88.55 1.37.55s1.03-.2 1.42-.6l3.87-4.12 4.26 4.15a1.974 1.974 0 0 0 2.79-2.79l-4.38-4.35ZM16.02 18.61Z',
                'color'  => '#eb7d01',
            ],
            'telegram'      => [
                'title'  => _x( 'Telegram', 'social provider', QUIZLE_TEXTDOMAIN ),
                'width'  => '32',
                'height' => '32',
                'path'   => 'M3.92 14.39c7.52-3.27 12.53-5.43 15.04-6.48 7.16-2.98 8.65-3.5 9.62-3.51.21 0 .69.05 1 .3.26.21.33.5.37.7.03.2.08.66.04 1.01-.39 4.08-2.07 13.97-2.92 18.54-.36 1.93-1.07 2.58-1.76 2.64-1.5.14-2.63-.99-4.09-1.94-2.27-1.49-3.55-2.41-5.75-3.87-2.55-1.68-.89-2.6.56-4.11.38-.39 6.98-6.4 7.1-6.94.02-.07.03-.32-.12-.46-.15-.13-.37-.09-.53-.05-.23.05-3.85 2.45-10.88 7.19-1.03.71-1.96 1.05-2.8 1.03-.92-.02-2.69-.52-4.01-.95-1.61-.52-2.9-.8-2.78-1.69.06-.46.7-.94 1.92-1.42Z',
                'color'  => '#64a9dc',
            ],
            'whatsapp'      => [
                'title'  => _x( 'Whatsapp', 'social provider', QUIZLE_TEXTDOMAIN ),
                'width'  => '32',
                'height' => '32',
                'path'   => 'M16.02 2C8.31 2 2.03 8.27 2.03 15.98c0 2.46.64 4.87 1.87 6.99L2 30l7.33-1.73a13.99 13.99 0 0 0 6.68 1.7c7.71 0 13.98-6.27 13.98-13.98 0-3.74-1.45-7.25-4.09-9.89C23.26 3.46 19.75 2 16.01 2Zm0 2.8c2.99 0 5.8 1.17 7.91 3.28a11.11 11.11 0 0 1 3.27 7.91c0 6.17-5.02 11.18-11.19 11.18-1.87 0-3.72-.47-5.34-1.36l-.94-.51-1.04.25-2.76.65.67-2.5.3-1.12-.58-1.01c-.98-1.69-1.49-3.62-1.49-5.59C4.83 9.82 9.85 4.8 16.01 4.8Zm-4.95 4.72c-.23 0-.61.09-.93.44-.32.35-1.23 1.19-1.23 2.91s1.25 3.38 1.43 3.61c.17.23 2.42 3.87 5.97 5.27 2.95 1.16 3.55.93 4.19.88.64-.06 2.07-.84 2.36-1.66.29-.82.29-1.52.21-1.66-.09-.15-.32-.23-.67-.41-.35-.18-2.07-1.02-2.39-1.13s-.56-.17-.79.18c-.23.35-.9 1.13-1.1 1.37-.2.23-.41.27-.76.09-.35-.18-1.48-.55-2.81-1.74-1.04-.93-1.74-2.07-1.94-2.42-.2-.35-.02-.54.16-.71.16-.16.35-.41.52-.61.17-.2.23-.35.35-.58.12-.23.06-.44-.03-.61-.09-.18-.77-1.9-1.08-2.59-.26-.58-.54-.59-.79-.6h-.67Z',
                'color'  => '#65bc54',
            ],
            'twitter'       => [
                'title'  => _x( 'Twitter', 'social provider', QUIZLE_TEXTDOMAIN ),
                'width'  => '32',
                'height' => '32',
                'path'   => 'M30 7.32c-1.03.46-2.14.77-3.3.9 1.19-.71 2.1-1.84 2.53-3.18-1.11.66-2.34 1.14-3.65 1.39a5.72 5.72 0 0 0-4.19-1.81 5.74 5.74 0 0 0-5.59 7.05c-4.77-.24-9.01-2.53-11.84-6-.49.85-.78 1.84-.78 2.89 0 1.99 1.01 3.75 2.55 4.78a5.71 5.71 0 0 1-2.6-.72v.07c0 2.78 1.98 5.11 4.61 5.63a5.79 5.79 0 0 1-2.59.1 5.756 5.756 0 0 0 5.37 3.99 11.53 11.53 0 0 1-7.13 2.46c-.46 0-.92-.03-1.37-.08 2.54 1.63 5.56 2.58 8.81 2.58 10.57 0 16.34-8.75 16.34-16.34 0-.25 0-.5-.02-.74 1.12-.81 2.1-1.82 2.87-2.97Z',
                'color'  => '#00aced',
            ],
            'facebook'      => [
                'title'  => _x( 'Facebook', 'social provider', QUIZLE_TEXTDOMAIN ),
                'width'  => '32',
                'height' => '32',
                'path'   => 'M12.01 7.4c0-.17.02-.55.07-1.13.05-.58.27-1.18.66-1.82.39-.63 1.02-1.2 1.89-1.7.87-.5 2.13-.75 3.77-.75h4.63v5.05h-3.39c-.34 0-.65.13-.93.37-.28.25-.42.48-.42.7v3.14h4.74c-.05.61-.1 1.21-.17 1.79l-.19 1.52c-.08.52-.15.99-.23 1.43h-4.2v13.99h-6.25V16H8.94v-4.75h3.05V7.39Z',
                'color'  => '#4267B2',
            ],
        ];

        $this->messengers = [
            'telegram' => [
                'title'  => _x( 'Telegram', 'messengers', QUIZLE_TEXTDOMAIN ),
                'width'  => '32',
                'height' => '32',
                'path'   => 'M3.92 14.39c7.52-3.27 12.53-5.43 15.04-6.48 7.16-2.98 8.65-3.5 9.62-3.51.21 0 .69.05 1 .3.26.21.33.5.37.7.03.2.08.66.04 1.01-.39 4.08-2.07 13.97-2.92 18.54-.36 1.93-1.07 2.58-1.76 2.64-1.5.14-2.63-.99-4.09-1.94-2.27-1.49-3.55-2.41-5.75-3.87-2.55-1.68-.89-2.6.56-4.11.38-.39 6.98-6.4 7.1-6.94.02-.07.03-.32-.12-.46-.15-.13-.37-.09-.53-.05-.23.05-3.85 2.45-10.88 7.19-1.03.71-1.96 1.05-2.8 1.03-.92-.02-2.69-.52-4.01-.95-1.61-.52-2.9-.8-2.78-1.69.06-.46.7-.94 1.92-1.42Z',
                'color'  => '#64a9dc',
            ],
            'whatsapp' => [
                'title'  => _x( 'Whatsapp', 'messengers', QUIZLE_TEXTDOMAIN ),
                'width'  => '32',
                'height' => '32',
                'path'   => 'M16.02 2C8.31 2 2.03 8.27 2.03 15.98c0 2.46.64 4.87 1.87 6.99L2 30l7.33-1.73a13.99 13.99 0 0 0 6.68 1.7c7.71 0 13.98-6.27 13.98-13.98 0-3.74-1.45-7.25-4.09-9.89C23.26 3.46 19.75 2 16.01 2Zm0 2.8c2.99 0 5.8 1.17 7.91 3.28a11.11 11.11 0 0 1 3.27 7.91c0 6.17-5.02 11.18-11.19 11.18-1.87 0-3.72-.47-5.34-1.36l-.94-.51-1.04.25-2.76.65.67-2.5.3-1.12-.58-1.01c-.98-1.69-1.49-3.62-1.49-5.59C4.83 9.82 9.85 4.8 16.01 4.8Zm-4.95 4.72c-.23 0-.61.09-.93.44-.32.35-1.23 1.19-1.23 2.91s1.25 3.38 1.43 3.61c.17.23 2.42 3.87 5.97 5.27 2.95 1.16 3.55.93 4.19.88.64-.06 2.07-.84 2.36-1.66.29-.82.29-1.52.21-1.66-.09-.15-.32-.23-.67-.41-.35-.18-2.07-1.02-2.39-1.13s-.56-.17-.79.18c-.23.35-.9 1.13-1.1 1.37-.2.23-.41.27-.76.09-.35-.18-1.48-.55-2.81-1.74-1.04-.93-1.74-2.07-1.94-2.42-.2-.35-.02-.54.16-.71.16-.16.35-.41.52-.61.17-.2.23-.35.35-.58.12-.23.06-.44-.03-.61-.09-.18-.77-1.9-1.08-2.59-.26-.58-.54-.59-.79-.6h-.67Z',
                'color'  => '#65bc54',
            ],
            'viber'    => [
                'title'  => _x( 'Viber', 'messengers', QUIZLE_TEXTDOMAIN ),
                'width'  => '32',
                'height' => '32',
                'path'   => 'M13.4 1.7C7.8 1.7 3 6.2 3 11.5V16c0 4.4 1.3 7.3 4.1 8.7v3c0 1 .6 1.9 1.5 2.3.3.1.7.2 1 .2.6 0 1.3-.2 1.8-.7l3.8-3.7h4c5.4 0 9.8-4.4 9.8-9.8v-4.5c0-5.4-4.4-9.8-9.8-9.8h-5.8zm0 2.6h5.8c4 0 7.2 3.2 7.2 7.2V16c0 4-3.2 7.2-7.2 7.2h-4.5c-.3 0-.7.1-.9.4l-4.1 4V24c0-.5-.3-1-.8-1.2-2.2-.9-3.2-3-3.2-6.7v-4.5c-.1-3.9 3.5-7.3 7.7-7.3zm3.9 1.3c-.4 0-.6.3-.6.6 0 .4.3.7.6.7 3.8 0 6.5 3.4 6.5 6.5 0 .4.3.6.7.6s.6-.3.6-.6c0-3.7-3.2-7.8-7.8-7.8zm-6.5 1.3c-.3 0-.6 0-.9.2l-.8.6c-.9.7-1.2 1.9-.7 2.9 1 1.9 2.6 4.8 3.9 6.1 1.7 1.5 4.3 3.4 6.5 4.3 1 .4 2.1.1 2.7-.7.2-.3.5-.6.7-.8.4-.5.3-1.3-.3-1.7l-2.4-1.7c-.5-.4-1.3-.3-1.6.2l-.4.5c-.3.3-.7.5-1.1.4-.6-.1-1.6-.5-2.7-1.7-.9-1-1.5-2.1-1.7-2.8-.1-.4 0-.9.4-1.2l.4-.3c.5-.4.6-1.1.2-1.6l-1.5-2.1c-.1-.4-.4-.5-.7-.6zm6.5 1.3c-.4 0-.6.3-.6.7s.3.6.6.6c2 0 3.9 1.9 3.9 3.9 0 .4.3.6.6.6s.6-.3.6-.6c.1-2.7-2.4-5.2-5.1-5.2zm0 2.6c-.4 0-.6.3-.6.6 0 .4.3.7.6.7.8 0 1.3.5 1.3 1.3 0 .4.3.6.6.6s.6-.3.6-.6c.1-1.6-.9-2.6-2.5-2.6z',
                'color'  => '#7360f2',
            ],
            'skype'    => [
                'title'  => _x( 'Skype', 'messengers', QUIZLE_TEXTDOMAIN ),
                'width'  => '32',
                'height' => '32',
                'path'   => 'M 11 4 C 7.144531 4 4 7.144531 4 11 C 4 12.03125 4.316406 12.988281 4.71875 13.875 C 4.589844 14.566406 4.5 15.269531 4.5 16 C 4.5 22.339844 9.660156 27.5 16 27.5 C 16.730469 27.5 17.433594 27.410156 18.125 27.28125 C 19.011719 27.683594 19.96875 28 21 28 C 24.855469 28 28 24.855469 28 21 C 28 19.96875 27.683594 19.011719 27.28125 18.125 C 27.410156 17.433594 27.5 16.730469 27.5 16 C 27.5 9.660156 22.339844 4.5 16 4.5 C 15.269531 4.5 14.566406 4.589844 13.875 4.71875 C 12.988281 4.316406 12.03125 4 11 4 Z M 11 6 C 11.863281 6 12.667969 6.210938 13.375 6.59375 C 13.585938 6.707031 13.828125 6.738281 14.0625 6.6875 C 14.691406 6.558594 15.332031 6.5 16 6.5 C 21.257813 6.5 25.5 10.742188 25.5 16 C 25.5 16.667969 25.441406 17.308594 25.3125 17.9375 C 25.261719 18.171875 25.292969 18.414063 25.40625 18.625 C 25.789063 19.332031 26 20.136719 26 21 C 26 23.773438 23.773438 26 21 26 C 20.136719 26 19.332031 25.789063 18.625 25.40625 C 18.414063 25.292969 18.171875 25.261719 17.9375 25.3125 C 17.308594 25.441406 16.667969 25.5 16 25.5 C 10.742188 25.5 6.5 21.257813 6.5 16 C 6.5 15.332031 6.558594 14.691406 6.6875 14.0625 C 6.738281 13.828125 6.707031 13.585938 6.59375 13.375 C 6.210938 12.667969 6 11.863281 6 11 C 6 8.226563 8.226563 6 11 6 Z M 15.84375 9.15625 C 13.371094 9.15625 10.71875 10.203125 10.71875 13 C 10.71875 14.347656 11.195313 15.773438 13.84375 16.4375 L 17.15625 17.25 C 18.152344 17.496094 18.40625 18.058594 18.40625 18.5625 C 18.40625 19.402344 17.574219 20.21875 16.0625 20.21875 C 13.109375 20.21875 13.488281 17.96875 11.90625 17.96875 C 11.195313 17.96875 10.6875 18.457031 10.6875 19.15625 C 10.6875 20.519531 12.363281 22.3125 16.0625 22.3125 C 19.582031 22.3125 21.3125 20.613281 21.3125 18.34375 C 21.3125 16.875 20.636719 15.34375 17.96875 14.75 L 15.53125 14.1875 C 14.605469 13.976563 13.53125 13.714844 13.53125 12.84375 C 13.53125 11.96875 14.273438 11.34375 15.625 11.34375 C 18.347656 11.34375 18.117188 13.21875 19.46875 13.21875 C 20.179688 13.21875 20.78125 12.8125 20.78125 12.09375 C 20.78125 10.414063 18.121094 9.15625 15.84375 9.15625 Z',
                'color'  => '#00aff0',
            ],
        ];
    }

    /**
     * @return array
     */
    public function get_share_providers() {
        return (array) apply_filters( 'quizle/social/share_providers', $this->share_providers );
    }

    /**
     * @param int  $quiz_id
     * @param bool $check_enabled
     *
     * @return array
     */
    public function get_quizle_providers( $quiz_id, $check_enabled = true ) {
        if ( $check_enabled && ! get_post_meta( $quiz_id, 'show-social-share', true ) ) {
            return [];
        }

        $providers = (array) get_post_meta( $quiz_id, 'social-share-providers', true );

        return array_intersect_key( $this->get_share_providers(), array_combine( $providers, $providers ) );
    }

    /**
     * @return array
     */
    public function get_messengers() {
        return (array) apply_filters( 'quizle/social/messengers', $this->messengers );
    }

    /**
     * @param int $quizle_id
     *
     * @return array
     */
    public function get_quizle_messengers( $quizle_id ) {
        $providers = (array) get_post_meta( $quizle_id, 'messenger-providers', true );

        return array_intersect_key( $this->get_messengers(), array_combine( $providers, $providers ) );
    }
}
