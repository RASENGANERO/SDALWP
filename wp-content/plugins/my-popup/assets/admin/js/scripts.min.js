!function(e){"function"==typeof define&&define.amd?define("scripts",e):e()}((function(){"use strict";jQuery((function(e){"undefined"!=typeof my_popup_edit_page&&(e(document).on("click",".js-mypopup-box-header-action-expand",(function(p){var o=e(this),t=o.parents(".mypopup-box").find(".js-mypopup-box-body");t.slideToggle(150,(function(){document.cookie=[encodeURIComponent("my-popup-box-hide:"+o.data("identity"))+"=1","max-age="+(t.is(":visible")?-1:31536e4),"path=/"].join("; ")}))})),function(e){var p="my-popup:tab",o=localStorage.getItem(p);function t(e){return e.substring(0,e.length-14)}function n(o){var n=e(o.attr("href"));o.hasClass("active")||(o.addClass("active"),n.parent().find(".wpshop-metabox-tab-content").removeClass("active"),n.addClass("active"),localStorage.setItem(p,t(o.attr("id"))))}e(".wpshop-metabox-tabs").each((function(){var p=e(this);p.find(".wpshop-metabox-tab-link").removeClass("active"),o&&p.find(".wpshop-metabox-tab-link").each((function(){var p=e(this);t(p.attr("id"))===o&&n(p)}))})),e(document).on("click",".wpshop-metabox-tab-link",(function(p){p.preventDefault();var o=e(this);o.parents(".wpshop-metabox-tabs").find(".wpshop-metabox-tab-link").removeClass("active"),n(o)}))}(e),function(e){var p=e(".js-mypopup-rules");function o(o,n){var a=e(".js-mypopup-rule-dump .js-mypopup-rule").clone();return p.prepend(a),a.find(".js-mypopup-rule-subtype .js-mypopup-ac-input").each(t("subtype")),a.find(".js-mypopup-rule-value .js-mypopup-ac-input").each(t("value")),n&&(a.addClass("mypopup-rule__highlight"),setTimeout((function(){a.removeClass("mypopup-rule__highlight")}),300)),o&&(i(),s()),a}function t(p){return function(){var o=e(this),t=o.parent(),s=t.find(".js-mypopup-ac-pills");t.find(".js-mypopup-ac-input").on("keydown",(function(p){8===p.keyCode&&(e(this).val().length||s.find(".js-mypopup-ac-pill").length&&(s.find(".js-mypopup-ac-pill").last().remove(),a(t),i()))})),o.autocomplete({source:function(t,a){var i=e.param({action:"my_popup_autocomplete_search_"+p,nonce:my_popup_rules_globals.nonce,query:o.val(),type:o.parents(".js-mypopup-rule").find(".js-mypopup-rule-type select").val(),values:n(o.parents(".js-mypopup-rule").find(".js-mypopup-rule-value")),subtypes:n(o.parents(".js-mypopup-rule").find(".js-mypopup-rule-subtype"))});e.getJSON(ajaxurl+"?"+i,t,(function(e,p,o){e.success?a(e.data):console.log(e)}))},minLength:1,select:function(e,p){e.preventDefault(),s.append('<span class="mypopup-ac-pill js-mypopup-ac-pill" data-id="'+p.item.value+'"><span class="mypopup-ac-pill-title">'+p.item.label+'</span><span class="mypopup-ac-pill-remove js-mypopup-ac-pill-remove">&times;</span></span>'),t.find(".js-mypopup-ac-input").val("").attr("placeholder",""),a(t),i()}}).autocomplete("widget").addClass("mypopup-ui-autocomplete")}}function n(p){var o=[];return p.find(".js-mypopup-ac-pill").each((function(){o.push(e(this).data("id"))})),o.join(",")}function a(e){e.find(".js-mypopup-ac-result").val(n(e))}function i(){var o=[];p.find(".js-mypopup-rule").each((function(){var p=e(this),t=p.find(".js-mypopup-rule-visible select").val(),n=p.find(".js-mypopup-rule-type select").val(),a=p.find(".js-mypopup-rule-value .js-mypopup-ac-result").val(),i={show:t,type:n,subtype:p.find(".js-mypopup-rule-subtype .js-mypopup-ac-result").val(),value:a};o.push(i)})),e("#rules_pages").val(JSON.stringify(o)),console.log("Rules:",o)}function s(){e(".js-mypopup-rule-type select").each((function(){var p=e(this),o=e(this).val(),t=p.parents(".js-mypopup-rule"),n=t.find(".js-mypopup-rule-value"),a=t.find(".js-mypopup-rule-subtype");my_popup_rules_globals.options_without_value.filter((function(e){return e===o})).length>0?n.hide():n.show(),my_popup_rules_globals.options_without_subtype.filter((function(e){return e===o})).length>0?a.hide():a.show()}))}s(),p.find(".js-mypopup-rule-subtype .js-mypopup-ac-input").each(t("subtype")),p.find(".js-mypopup-rule-value .js-mypopup-ac-input").each(t("value")),e(document).on("click",".js-mypopup-rule-add",(function(){o(!0,!0)})),e(document).on("click",".js-mypopup-rule-remove",(function(){e(this).parents(".js-mypopup-rule").remove(),i()})),e(document).on("change",".js-mypopup-rule-visible select",(function(){i()})),e(document).on("change",".js-mypopup-rule-type select",(function(){var p=e(this).parents(".js-mypopup-rule");p.find(".js-mypopup-ac-pills").empty(),a(p.find(".js-mypopup-ac-container")),i(),s()})),e(document).on("change",".js-mypopup-rule-value input",(function(){i()})),e(document).on("click",".js-mypopup-ac-container",(function(){e(this).find(".js-mypopup-ac-input").trigger("focus")})),e(document).on("click",".js-mypopup-ac-pill-remove",(function(){var p=e(this),o=p.parents(".js-mypopup-ac-container");p.parent(".js-mypopup-ac-pill").remove(),a(o),i()})),p.sortable({update:function(e,p){i()},start:function(e,p){p.item.addClass("mypopup-rule__highlight")},stop:function(e,p){setTimeout((function(){p.item.removeClass("mypopup-rule__highlight")}),500)}});var u,l,c=e(".js-my-popup-preview-area"),r=e(".js-popup-preview-refresh"),d=e(".js-popup-preview-hide"),m=e(".js-popup-preview-stick"),_=e(".js-popup-preview"),y=c.data("base_url"),v={},f={act:"preview-popup",id:c.data("id")};function h(){x()||(clearTimeout(l),l=setTimeout((function(){if(!c.find("iframe").length){var p=e("<iframe>").attr({src:y+"?"+e.param(f),name:"my-popup-preview",width:"100%",height:600});c.empty().append(p)}b()}),200))}function b(){var p=e("<form>").attr("action",y+"?"+e.param({act:"preview-popup",id:c.data("id")})).attr("method","post").attr("target","my-popup-preview");e(".js-my-popup-settings").find("input, select, textarea").each((function(){var o=e(this),t=o.clone();t.is("select")&&t.val(o.val()),p.append(t)}));var o=p.find('textarea[name="my_popup_editor_content"]');o.length&&(o.attr("name","display_box[my_popup_editor_content]"),u&&o.val(u.getContent()));var t=e("<div>").css("display","none").append(p);e("body").append(t),p.submit(),t.remove()}window.post_to_iframe=b,e(document).on("change",".js-my-popup-change-observable",(function(){h()})),e(document).on("color-picker:change",(function(p){e(p.target).hasClass("js-my-popup-change-observable")&&setTimeout((function(){h()}),50)})),e(document).on("color-picker:clear",(function(p){e(p.target).hasClass("js-my-popup-change-observable")&&h()}));var g=10,j=setInterval((function(){if(--g<0)return clearInterval(j),void console.error("Unable to init observe of editors changes");"undefined"!=typeof tinymce&&void 0!==tinymce.editors.my_popup_editor_content&&(console.log("Init observe of editors changes"),u=tinymce.editors.my_popup_editor_content,tinymce.editors.my_popup_editor_content.onChange.add((function(e,p){v.content=e.getContent(),h()})),clearInterval(j))}),1e3);function x(){return localStorage.getItem("my-popup:hide_preview")}function w(){var e=d.text();d.text(d.data("toggle_txt")),d.data("toggle_txt",e)}r.on("click",h),x()||h(),x()&&(c.hide(),r.hide(),w()),d.on("click",(function(){w(),c.is(":visible")?(c.slideUp(100),r.hide(),localStorage.setItem("my-popup:hide_preview",1)):c.slideDown(100,(function(){r.show(),localStorage.removeItem("my-popup:hide_preview"),h()}))})),m.on("click",(function(){var e=m.text();m.text(m.data("toggle_txt")),m.data("toggle_txt",e),_.toggleClass("sticky")}));var k,C,I={},S=[],T=wp.template("my-popup-html-code"),D=e(".js-html-code-container");function O(p,o){return void 0===p?[]:(void 0===o&&(o=parseInt(p.substring(23))),D.append(T({input_id:"my_popup_prepared_code_"+o,shortcode_id:o})),e("#my_popup_prepared_code_"+o))}function N(p){var t=!1;S.forEach((function(e){t=t||e()}));p.forEach((function(p){if("__editor_content__"!==p.type){var n;void 0!==p.id&&p.id.length?n="#"+p.id:(n="textarea"===p.type?'textarea[name="'+p.name+'"]':'[name="'+p.name+'"]',"select"!==p.type&&"textarea"!==p.type&&(n=n+'[type="'+p.type+'"]'));var l=e(n);if(l.length||(void 0!==I[p.name]&&(l=I[p.name](p.id)),l.length))U(l)!==p.value&&(function(p,o,t){t=void 0!==t&&t,"0"===o&&(o=0);p.is(":checkbox")?p.prop("checked",!!o):p.is(":radio")?e('input[name="'+p.prop("name")+'"][value="'+o+'"]').prop("checked",!!o):t&&""!==p.val()||(p.hasClass("js-wpshop-color-picker")&&void 0!==e.fn.wpColorPicker&&p.wpColorPicker("color",o),p.val(o),p.is(":hidden")&&p.trigger("change"))}(l,p.value,function(e){return-1!==e.name.indexOf("display_box[my_popup_social_")&&!["display_box[my_popup_type_social_buttons][value]","display_box[my_popup_social_buttons_align][value]","display_box[my_popup_social_buttons_width][value]","display_box[my_popup_social_buttons_height][value]","display_box[my_popup_social_buttons_indent][value]","display_box[my_popup_hide_social_links][is_enabled]"].includes(e.name)}(p)),l[0].hasAttribute("data-preview_param")&&(t=!0),"rules_pages"===p.id&&function(p){var t=JSON.parse(p.value),n=p.preRenderedPills;e(".js-mypopup-rules").empty(),t.forEach((function(e,p){var t=o();t.find(".js-mypopup-rule-visible select").val(e.show),t.find(".js-mypopup-rule-type select").val(e.type),t.find(".js-mypopup-ac-pills").append(n[p]),a(t)})),s(),i()}(p))}else u&&(t=u.getContent()!==p.value,u.setContent(p.value),v.content=p.value)})),t&&h()}function E(){var p=[],o={};return u&&p.push({name:"__editor_content__",type:"__editor_content__",value:u.getContent()}),e(".js-my-popup-preset").each((function(){var t=e(this),n=t.attr("name"),a=t.attr("id"),i=void 0!==a?a:n;o.hasOwnProperty(i)||(o[i]=1,p.push({id:t.attr("id"),name:t.attr("name"),value:U(t),type:R(t)}))})),p}function J(e,p,o){o=o||4e3;var t=p?"success":"fail";e.addClass(t),clearTimeout(C),C=setTimeout((function(){e.removeClass(t)}),o)}function R(e){var p=e[0].tagName.toLowerCase();return"input"===p?e[0].type.toLowerCase():p}function U(p){var o=p.val();return p.is(":checkbox")&&(p.is(":checked")||(o=e('input[type="hidden"][name="'+p.prop("name")+'"]').val())),p.is(":radio")&&(o=e('input[name="'+p.prop("name")+'"]:checked').val()),o}I["display_box[my_popup_prepared_code][]"]=O,I["display_box[my_popup_prepared_code]"]=O,S.push((function(){var p=D.find(".wpshop-meta-row").slice(1);return!!p.length&&(p.each((function(){e(this).remove()})),!0)})),e(document).on("click",".js-add-html-code",(function(e){e.preventDefault(),O("my_popup_prepared_code_"+(D.find(".wpshop-meta-row").length+1))})),e(document).on("click",".js-remove-html-code",(function(p){p.preventDefault(),e(this).parents(".wpshop-meta-row").remove();var o=0;D.find(".wpshop-meta-row").each((function(){var p=e(this);o++,p.find(".js-shortcode-example").text("[mypopup_html id="+o+"]"),p.find("textarea").attr("id","my_popup_prepared_code_"+o)}))})),e(".js-my-popup-select-preset").on("click",(function(p){p.preventDefault();var o=e(this);e.ajax({url:my_popup_globals.ajax_url,type:"post",data:{action:"my_popup_preset_select",nonce:my_popup_globals.nonce,id:o.val()},beforeSend:function(){o.attr("disabled",!0),x()||e([document.documentElement,document.body]).animate({scrollTop:c.offset().top-50},500)}}).done((function(e){e.success&&N(e.data.result.items)})).always((function(){o.prop("disabled",!1)}))})),e(".js-popup-save-preset").on("click",(function(p){p.preventDefault();var o=e(this),t=E();e.ajax({url:my_popup_globals.ajax_url,type:"post",data:{action:"save_my_popup_preset",nonce:my_popup_globals.nonce,name:e(".js-popup-preset-name").val(),image:e(".js-popup-preset-image").val(),items:t},beforeSend:function(){o.attr("disabled",!0)}}).done((function(e){J(o,e.success)})).fail((function(){J(o,!1)})).always((function(){o.prop("disabled",!1)}))})),e(".js-my-popup-remove-preset").on("click",(function(p){p.preventDefault();var o=e(this);e.ajax({url:my_popup_globals.ajax_url,type:"post",data:{action:"my_popup_preset_remove",nonce:my_popup_globals.nonce,id:o.data("id")},beforeSend:function(){o.attr("disabled",!0)}}).done((function(e){e.success&&o.closest(".js-preset-row").remove()})).always((function(){o.prop("disabled",!1)}))})),e(document).on("click",".js-mypopup-export",(function(p){p.preventDefault();var o=e(".js-mypopup-export-success-message"),t=function(){var p=E(),o=e("#rules_pages");e(".js-mypopup-export-with-rules").is(":checked")&&p.push({id:o.attr("id"),name:o.attr("name"),value:U(o),type:R(o)});return["display_box[my_popup_cookies_type][is_enabled]","display_box[my_popup_cookies_type][value]",["select","display_box[my_popup_cookies_type][mode]"],"display_box[my_popup_close_overlay][is_enabled]","display_box[my_popup_close_esc][is_enabled]","display_box[my_popup_page_scrolling][is_enabled]","display_box[my_popup_close_time][is_enabled]","display_box[my_popup_close_time][value]","display_box[my_popup_display_desktop][is_enabled]","display_box[my_popup_display_tablet][is_enabled]","display_box[my_popup_display_mobile][is_enabled]","display_box[my_popup_enable]","display_box[my_popup_show_on_time][is_enabled]","display_box[my_popup_show_on_time][value]","display_box[my_popup_show_on_scroll][is_enabled]","display_box[my_popup_show_on_scroll][value]","display_box[my_popup_show_on_element][is_enabled]","display_box[my_popup_show_on_element][value]","display_box[my_popup_show_inactive_time][is_enabled]","display_box[my_popup_show_inactive_time][value]","display_box[my_popup_show_leaves_page][is_enabled]","display_box[my_popup_show_on_click][is_enabled]","display_box[my_popup_show_on_click][selector]"].forEach((function(o){(Array.isArray(o)?e(o[0]+'[name="'+o[1]+'"]'):e('input[name="'+o+'"]')).each((function(){var o=e(this);p.push({id:o.attr("id"),name:o.attr("name"),value:U(o),type:R(o)})}))})),p}();console.log(t);var n=btoa(encodeURIComponent(JSON.stringify(t))),a=e("<textarea>").val(n);a.appendTo("body"),a.get(0).focus(),a.get(0).select();try{document.execCommand("copy")&&(o.fadeIn(150),clearTimeout(k),k=setTimeout((function(){o.fadeOut(150)}),3e3))}catch(e){console.error(e)}a.remove()})),e(document).on("click",".js-mypopup-import",(function(p){p.preventDefault();var o=e(this),t=e(".js-mypopup-import-input"),n=t.val();if(void 0!==n&&n.length)try{n=JSON.parse(decodeURIComponent(atob(n))),e.ajax({url:my_popup_globals.ajax_url,type:"post",data:{action:"my_popup_prepare_import",nonce:my_popup_globals.nonce,items:n},beforeSend:function(){o.attr("disabled",!0)}}).done((function(e){N(e.data.items),t.val("")})).always((function(){o.attr("disabled",!1)}))}catch(e){console.error(e)}}))}(e),e(document).on("click",".js-my-popup-close-btn-icon",(function(p){p.preventDefault();var o=e(this);o.parents(".js-my-popup-close-btn-icon-container").find(".js-my-popup-close-btn-icon-value").val(o.data("value")).trigger("change")})),e(document).on("change",".js-my-popup-close-btn-icon-value",(function(){var p=e(this),o=p.parents(".js-my-popup-close-btn-icon-container");o.find(".js-my-popup-close-btn-icon").removeClass("selected"),o.find('.js-my-popup-close-btn-icon[data-value="'+p.val()+'"]').addClass("selected")})))}))}));